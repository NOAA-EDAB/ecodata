#### Get Community Climate Change Risk Indicators (CCCRI)

library(readxl)
library(dplyr)
library(tidyr)

# Set directory
raw.dir <- here::here("data-raw")

# Define input files
comm_clim_vuln_xlsx <- "CCCVI_NE - Tarsila Seara - NOAA Federal.xlsx"

get_community_climate_vulnerability <- function(save_clean = F){
  # Create data frame to define State-EPU
  df<- data.frame(State = c("ME", "MA", "RI", "CT", "DE", "NH", "NY", "NJ", "MD", "VA", "NC"),
                  EPU = c("NE", "NE", "NE", "NE", "NE", "NE","MAB","MAB","MAB","MAB","MAB"))

  community_climate_vulnerability <- readxl::read_excel(file.path(raw.dir,comm_clim_vuln_xlsx),
                                       sheet = "CCCVI_NE_clean") |>
    tidyr::pivot_longer(cols = c("class_lbs_percent",
                                 "class_val_percent",
                                 "oaSum",
                                 "tempSum",
                                 "stckSum",
                                 "sensSum",
                                 "vulnSum",
                                 "RegionalQuotientLbs",
                                 "RegionalQuotientVal",
                                 "recsimplb_all",
                                 "recsimplvl_all",
                                 "oaSum_region",
                                 "tempSum_region",
                                 "stckSum_region",
                                 "sensSum_region",
                                 "vulnSum_region"),
                        names_to = "Var", values_to = "Value") |>
    dplyr::rename("State" = "STATE_ABB",
                  "Port" = "PORT_NAME",
                  "Time" = "YEAR") |>
    left_join(df, by = "State")

  if (save_clean){
    usethis::use_data(community_climate_vulnerability, overwrite = T)
  } else {
    return(community_climate_vulnerability)
  }
}
get_community_climate_vulnerability(save_clean = T)
